<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.79.0">
    <title>Node.JS Home Page</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/sign-in/">



    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="/docs/5.0/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="/docs/5.0/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/docs/5.0/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="manifest" href="/docs/5.0/assets/img/favicons/manifest.json">
    <link rel="mask-icon" href="/docs/5.0/assets/img/favicons/safari-pinned-tab.svg" color="#7952b3">
    <link rel="icon" href="/docs/5.0/assets/img/favicons/favicon.ico">
    <meta name="theme-color" content="#7952b3">

    <!--<link rel="stylesheet" href="/css/ui.css">-->


    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        ul,
        li,
        section,
        div {
            padding: 0;
            margin: 0
        }

        li {
            list-style: none;
        }


        .showWrap {
            width: 1000px;
            margin: 30px auto;
            overflow-y: auto;
        }


        .formWrap {
            width: 600px;
            /* overflow-y: auto;*/
            margin: 30px auto;
        }


        form span {
            display: inline-block;
            width: 80px;
        }

        .showWrap>ul {
            overflow: auto;
            width: 1500px;
            margin: 0px auto;
            background-color: #f3f2f2;
        }

        .showWrap>ul>li {
            padding: 60px;
            width: 200px;
            float: left;
            border-right: 1px solid #e6dada;
            height: 500px;
        }

        .showWrap form>div {
            margin-bottom: 12px;
        }

        .showWrap button {
            width: 120px;
            height: 30px;
            margin-top: 20px;
        }

        .showResult {
            margin-top: 30px;
        }

        .showResult li {
            margin-bottom: 16px;
        }


    </style>

    <link href="/css/signin.css" rel="stylesheet">
    <link rel="stylesheet" href="/cover.css">


</head>

<body class="d-flex text-center text-white bg-dark">

    <div class="cover-container p-3 mx-auto flex-column">
        <header class="mb-auto">
            <div>
                <nav class="nav nav-masthead justify-content-center float-md-end">
                    <a class="nav-link active" aria-current="page" href="/main">Home</a>
                    <a class="nav-link" href="/logout">Logout</a>
                </nav>
            </div>
        </header>


        <h1>Movie list API Test</h1>

        <section class="showWrap">
            <ul>
                <li class="get_all">
                    <button>모든영화보기</button>
                    <section class="showResult"></section>
                </li>

                <li class="post">
                    <form action="/" method="post">
                        <div> 제목 : <input type="text" name="title" placeholder="Terminator"> </div>
                        <div> 장르 : <input type="text" name="type" placeholder="drama"> </div>
                        <div> 평점 : <input type="text" name="grade" placeholder="8.43"> </div>
                        <div> 주연 : <input type="text" name="actor" placeholder="Tom cruise"> </div>
                    </form>
                    <button>영화추가</button>
                    <section class="showResult"></section>
                </li>

                <li class="get_id">
                    <input type="text" name="title">
                    <button>영화상세정보</button>
                    <section class="showResult"></section>
                </li>

                <li class="delete_id">
                    <input type="text" name="title">
                    <button>영화삭제</button>
                    <section class="showResult"></section>

                </li>

                <li class="update_id">
                    <form action="" method="post">
                        <div> 제목 : <input type="text" name="title" placeholder="Terminator"> </div>
                        <div> 장르 : <input type="text" name="type" placeholder="drama"> </div>
                        <div> 평점 : <input type="text" name="grade" placeholder="8.43"> </div>
                        <div> 주연 : <input type="text" name="actor" placeholder="Tom cruise"> </div>
                    </form>
                    <button>영화정보갱신</button>
                    <!--<section class="showResult">ㅁㅁ</section>-->
                </li>

                <li class="get_min">
                    <button>현재 상영중인영화</button>
                    <!--<section class="showResult">aaa</section>-->
                </li>
            </ul>
        </section>
    </div>


    <script>
        document.querySelector('.showWrap').addEventListener('click', function (e) {
            let url, method, data, fn;
            const target = e.target;
            const li = target.closest('LI');
            const showResult = li.querySelector(".showResult");
            const type = li.className;
            if (target.tagName !== "BUTTON") return;
            switch (type) {
                case "get_all":
                    url = "/movie";
                    method = "GET";
                    fn = function (result) {
                        if (result.result === 1) {
                            let titles = result.data.reduce(function (pre, next) {
                                pre += "<li>" + next.title + "</li>"
                                return pre;
                            }, "");
                            showResult.innerHTML = "<ul>" + titles + "</ul>";
                        } else {
                            showResult.innerHTML = "list not found";
                        }
                    }
                    break;
                case "post":
                    url = "/movie";
                    method = "POST";
                    let inputs = [].slice.call(document.querySelector("form").elements);
                    data = inputs.reduce(function (pre, next) {
                        pre[next.name] = next.value;
                        return pre;
                    }, {});
                    fn = function (result) {
                        if (result.result === 1) showResult.innerHTML = "새로운 영화 데이터가 잘 추가됐습니다.";
                        else showResult.innerHTML = "list not found";
                    }
                    break;
                case "get_id":
                    url = "/movie/" + li.getElementsByTagName("input")[0].value;
                    method = "GET";
                    fn = function (result) {
                        if (result.result === 1) {
                            showResult.innerHTML = result.data[0].actor;
                        } else {
                            showResult.innerHTML = "해당하는 영화가 없네요..";
                        }
                    }
                    break;
                case "delete_id":
                    url = "/movie/" + li.getElementsByTagName("input")[0].value;
                    method = "DELETE";
                    fn = function (result) {
                        if (result.result === 1) {
                            showResult.innerHTML = "선택한영화" + result.data + "가 잘 삭제됐습니다";
                        } else {
                            showResult.innerText = "해당영화가 없습니다";
                        }
                    }
                    break;
                default:
                    // statements_def
                    console.log("default");
                    break;
            }
            sendAjax(url, method, data, fn);
        })
        //@data : json format.
        function sendAjax(url, method, data, fn) {
            const xhr = new XMLHttpRequest();
            xhr.open(method, url);
            if (data) {
                data = JSON.stringify(data);
                xhr.setRequestHeader('Content-Type', "application/json");
            } else {
                data = null;
            }
            xhr.send(data);
            xhr.addEventListener('load', function () {
                const result = JSON.parse(xhr.responseText);
                fn(result);
            });
        }
    </script>

</body>

</html>